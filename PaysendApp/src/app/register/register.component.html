<!-- Navbar -->
<navbar-front></navbar-front>

<!-- Registreringsformulär -->
<div class="primary-gradient minheight-100 padding-102px-top pb-5">
    <div class="col-xl-4 offset-xl-4 col-md-6 offset-md-3 col-12 col-sm-8 offset-sm-2 card">
        <ul class="nav nav-tabs justify-content-center card-header card-header-custom pb-0">
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#register" role="tab">Skapa gästkonto</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#bankid" role="tab">Logga in med BankID</a>
            </li>
        </ul>
        <div class="tab-content col-sm-12 margin-md-top margin-md-bottom justify-content-center">
             <div class="tab-pane fade show col-sm-12" id="register" role="tabpanel">
                <form name="form" (ngSubmit)="f.form.valid && password.value == confirmPassword.value && register() " #f="ngForm" novalidate>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !firstName.valid }">
                                <input mdbInput type="text" class="form-control" name="firstName" [(ngModel)]="model.FirstName" #firstName="ngModel" required/>
                                <label for="firstName">Förnamn *</label>
                                <div *ngIf="f.submitted && !firstName.valid" class="help-block">Fyll i förnamn</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !lastName.valid }">
                                <input mdbInput type="text" class="form-control" name="lastName" [(ngModel)]="model.LastName" #lastName="ngModel"  required />
                                <label for="lastName">Efternamn *</label>
                                <div *ngIf="f.submitted && !lastName.valid" class="help-block">Fyll i efternamn</div>
                            </div>
                        </div>
                    </div>
                    <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !personId.valid }">
                        <input mdbInput type="text" class="form-control" name="personId" [(ngModel)]="model.PersonId" #personId="ngModel" required />
                        <label for="personId">Personnummer (ååmmdd-xxxx)*</label>
                        <div *ngIf="f.submitted && !personId.valid" class="help-block">Fyll i giltigt personnummer</div>
                    </div>
                    <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !email.valid }">
                        <input mdbInput type="text" class="form-control" name="email" [(ngModel)]="model.Email" #email="ngModel" />
                        <label for="email">E-post</label>
                        <div *ngIf="f.submitted && !email.valid" class="help-block">Fyll i giltig e-post</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !password.valid }">              
                                <input mdbInput type="password" class="form-control" name="password" [(ngModel)]="model.Password" #password="ngModel"  required/>
                                <label for="password">Lösenord *</label>
                                <div *ngIf="f.submitted && !password.valid" class="help-block">Fyll i lösenord</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && password.value !== confirmPassword.value}">
                                <input mdbInput type="password" class="form-control" name="confirmPassword" [(ngModel)]="model.ConfirmPassword" #confirmPassword="ngModel"  required/>
                                <label for="confirmPassword">Bekräfta lösenord *</label>
                                <div *ngIf="f.submitted && password.value !== confirmPassword.value" class="help-block">Lösenorden matchar inte</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !phoneMobile.valid }">
                                <input mdbInput type="text" class="form-control" name="phoneMobile" [(ngModel)]="model.PhoneMobile" #phoneMobile="ngModel" />
                                <label for="phoneMobile">Mobilnummer</label>
                                <div *ngIf="f.submitted && !phoneMobile.valid" class="help-block">Fyll i giltigt mobilnummer</div>
                            </div>
                        </div>

                        <!-- Fields below will be deleted at launch, only here for developing purposes -->
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !address.valid }">
                                <input mdbInput type="text" class="form-control" name="address" [(ngModel)]="model.Address" #address="ngModel" required />
                                <label for="address">Gatuadress *</label>                                
                                <div *ngIf="f.submitted && !address.valid" class="help-block">Fyll i giltig adress</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !postalCode.valid }"> 
                                <input mdbInput type="text" class="form-control" name="postalCode" [(ngModel)]="model.PostalCode" #postalCode="ngModel" required />
                                <label for="postalCode">Postkod *</label>
                                <div *ngIf="f.submitted && !postalCode.valid" class="help-block">Fyll i giltig postkod</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="md-form" [ngClass]="{ 'has-error': f.submitted && !city.valid }">
                                <input mdbInput type="text" class="form-control" name="city" [(ngModel)]="model.City" #city="ngModel" required/>
                                <label for="city">Postort *</label>                                
                                <div *ngIf="f.submitted && !city.valid" class="help-block">Fyll i giltig postort</div>
                            </div>
                        </div>
                    </div>

                    <!--<pre>{{model | json}}</pre>-->
                    <div class="form-group row">
                        <div class="col-6 px-2 text-left">
                            <button [disabled]="loading" class="btn btn-primary mx-2" role="button">Registrera dig</button>
                            <loading-spinner *ngIf="loading"></loading-spinner>
                        </div>
                        <div class="col-6 px-2 text-right">
                            <a [routerLink]="['/front']" class="btn btn-outline-primary mx-2">Avbryt</a>
                        </div>
                    </div>
                </form>
            </div>
            <div class="tab-pane fade show active col-sm-12" id="bankid" role="tabpanel">
                <div class="section-content">
                    <div class="container">
                        <div class="row justify-content-center align-items-center">
                            <div class="col-12 text-center">
                                <img class="bankid-img" src="assets/img/undraw_confirmed_81ex.svg" alt="BankID" />
                            </div>
                            <form name="bankidform" class="px-4 py-3" (ngSubmit)="bankidform.form.valid && bankIdAuth()" #bankidform="ngForm" novalidate>
                                <div *ngIf="bankIdPending">
                                    <loading-spinner></loading-spinner>
                                    <p>Väntar på svar från Mobilt BankID</p>
                                </div>

                                <div *ngIf="!bankIdPending" class="md-form" [ngClass]="{ 'has-error': f.submitted && !email.valid }">
                                    <input mdbInput id="FormPersonId" type="text" class="form-control"  name="personid" [(ngModel)]="model.PersonId" #personid="ngModel" required />
                                    <label for="FormPersonId">Personnummer</label>
                                    <div *ngIf="bankidform.submitted && !personid.valid" class="help-block">Ange personnummer</div>
                                </div>

                                <button class="btn btn-primary btn-block" role="button">Logga in med BankID</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>